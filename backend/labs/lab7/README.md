# Лабораторна робота №7: Розгортання програмного забезпечення

## Зміст
1. [Налаштування CI](#1-налаштування-ci)
2. [Налаштування CD](#2-налаштування-cd)
3. [Доступність сервісу](#3-доступність-сервісу)
4. [Висновок](#4-висновок)
5. [Подальші кроки](#5-подальші-кроки)

---

## 1. Налаштування CI

**Ціль:** Забезпечення автоматичної перевірки якості коду та дотримання стилю як на локальному рівні, так і при створенні Pull Request'ів або комітів до гілки `lab7`.

---

### **Інструменти:**
- **Prettier**: Автоматичне форматування коду.
- **ESLint**: Перевірка коду на статичні помилки.
- **CommitLint**: Перевірка повідомлень комітів на відповідність стандарту Conventional Commits.
- **Husky**: Використовується для виконання локальних Git-хуків (pre-commit та commit-msg).
- **GitHub Actions**: Виконує перевірки на рівні CI (сборка, лінтинг, тестування).

---

### **Локальні перевірки за допомогою Husky**

Husky використовується для автоматичного запуску перевірок при створенні комітів.

#### **Налаштування Husky:**
1. Husky інтегрується через скрипт `prepare`, зазначений у `package.json`:
   ```json
   "prepare": "husky install"
   ```
2. Хуки налаштовані через файли:
   - **`pre-commit`:** Виконує перевірку ESLint та Prettier.
   - **`commit-msg`:** Перевіряє стиль комітів за допомогою CommitLint.

#### **Зміст файлів:**
- **pre-commit**: [Файл pre-commit](../../../.husky/pre-commit)
  ```bash
  npm run lint
  npm run format
  ```
- **commit-msg**: [Файл commit-msg](../../../.husky/commit-msg)
  ```bash
  npx --no-install commitlint --edit "$1"
  ```

#### **Конфігурації:**
- **CommitLint:** Використовує конфігурацію Conventional Commits:
  ```json
  {
    "extends": ["@commitlint/config-conventional"]
  }
  ```
- **ESLint і Prettier:** Конфігурації розташовані у файлах:
  - ESLint: [eslint.config.js](../../../eslint.config.js)
  - Prettier: [`.prettierrc`](../../../.prettierrc)

#### **Результат:**
- **Коміт блокується**, якщо не виконані вимоги щодо коду чи стилю комітів.
- Всі файли форматуються та перевіряються перед додаванням у репозиторій.

---

### **Серверні перевірки через GitHub Actions**

GitHub Actions забезпечує автоматизацію перевірок на рівні сервера.

#### **CI Конфігурація (файл [ci.yml](../../../.github/workflows/ci.yml))**:
- Виконується на кожен **Pull Request** і **Push** у гілку `lab7`.
- Основні етапи:
  1. **Checkout коду.**
  2. **Установка залежностей.**
  3. **Перевірка коду ESLint та Prettier.**
  4. **Сборка проекту.**
  5. **Виконання тестів.**

#### **Результат:**
- CI гарантує, що Pull Request не може бути злитий без проходження перевірок.

---

### **Файли та конфігурації**
1. **Husky:** [`.husky/pre-commit`](../../../.husky/pre-commit), [`.husky/commit-msg`](../../../.husky/commit-msg)
2. **GitHub Actions:** [`.github/workflows/ci.yml`](../../../.github/workflows/ci.yml)
3. **Скрипти package.json:**
   ```json
   {
     "scripts": {
       "lint": "eslint .",
       "format": "prettier --write .",
       "prepare": "husky install"
     }
   }
   ```

--- 

### **Результат**
- Локальні перевірки Husky гарантують якість перед комітами.
- CI через GitHub Actions забезпечує додатковий рівень контролю під час розробки та злиття.

## 2. Налаштування CD

**Ціль:** Автоматичне розгортання нової версії проекту на сервері після додавання нових змін до вiтки `lab7`.

### **Інструменти:**
- **PM2**: для управління процесами Node.js додатків.
- **GitHub Actions**: для автоматичного розгортання.
- **Nginx**: для проксування запитів на фронтенд і бекенд.

### **Налаштування:**
1. **PM2:**
   - Для фронтенда:
     ```bash
     pm2 start npm --name "frontend-lab7" -- start
     ```
   - Для бекенда:
     ```bash
     pm2 start index.js --name "backend-lab7"
     ```
2. **Nginx:**
   - Налаштований для проксування запитів:
     - **Фронтенд:** `https://lingo-cards.pro`
     - **Бекенд:** `https://api.lingo-cards.pro`
   - Перевірити конфігурацію Nginx:
     ```bash
     sudo nginx -t
     sudo systemctl reload nginx
     ```
3. **GitHub Actions для CD:**
   - Додано файл [.github/workflows/cd.yml](../../../.github/workflows/cd.yml), який:
     - Перевіряє код.
     - Підключається до сервера через SSH.
     - Автоматично виконує команду `git pull` і перезапускає додатки через PM2.

### **Результат:**
- Нові зміни автоматично розгортаються на сервері при кожному пуші до гілки `lab7`.

---

## 3. Доступність сервісу

### **Домен:**
- **Frontend:** [https://lingo-cards.pro](https://lingo-cards.pro)
- **Backend API:** [https://api.lingo-cards.pro](https://api.lingo-cards.pro)

### **Додатки працюють на портах:**
- **Frontend:** 3000 (проксування через Nginx).
- **Backend:** 5000 (проксування через Nginx).

### **Перевірка доступності:**
1. За доменами: `curl https://lingo-cards.pro`.
2. API: `curl https://api.lingo-cards.pro`.

---

## 4. Висновок

1. **CI** успішно налаштовано для автоматичної перевірки комітів та Pull Request'ів.
2. **CD** забезпечує автоматичне розгортання змін на сервері.
3. Сервіс доступний за доменами і відповідає вимогам лабораторної роботи.

---

